<svg width="850" height="600" viewBox="0 0 850 600" xmlns="http://www.w3.org/2000/svg">
    <defs>
        <filter id="shadow" x="-20%" y="-20%" width="140%" height="140%">
            <feDropShadow dx="2" dy="2" stdDeviation="3" flood-color="#000000" flood-opacity="0.12"/>
        </filter>
    </defs>

    <!-- ============================================================ -->
    <!-- LEFT ZONE: USER INTERFACE -->
    <!-- ============================================================ -->
    <rect x="15" y="50" width="150" height="270" rx="12" fill="#f0fdf4" stroke="#86efac" stroke-width="2"/>
    <text x="90" y="72" font-family="Arial, sans-serif" font-size="11" font-weight="bold" fill="#166534" text-anchor="middle">User Interface</text>

    <!-- User -->
    <ellipse cx="90" cy="105" rx="45" ry="20" fill="#fecaca" stroke="#f87171" stroke-width="2"/>
    <text x="90" y="110" font-family="Arial, sans-serif" font-size="11" fill="#991b1b" text-anchor="middle">User</text>

    <!-- GUI -->
    <rect x="25" y="140" width="130" height="50" rx="10" fill="#86efac" stroke="#22c55e" stroke-width="2" filter="url(#shadow)"/>
    <text x="90" y="162" font-family="Arial, sans-serif" font-size="11" font-weight="bold" fill="#166534" text-anchor="middle">Interface</text>
    <text x="90" y="178" font-family="Arial, sans-serif" font-size="9" fill="#166534" text-anchor="middle">PyQt6 (GUI)</text>

    <!-- Workers -->
    <rect x="25" y="215" width="130" height="50" rx="10" fill="#bfdbfe" stroke="#3b82f6" stroke-width="2" filter="url(#shadow)"/>
    <text x="90" y="237" font-family="Arial, sans-serif" font-size="11" font-weight="bold" fill="#1e40af" text-anchor="middle">Workers</text>
    <text x="90" y="253" font-family="Arial, sans-serif" font-size="9" fill="#1e40af" text-anchor="middle">(QThread)</text>

    <!-- Interface Arrows -->
    <line x1="90" y1="125" x2="90" y2="135" stroke="#555" stroke-width="1.5"/>
    <polygon points="90,140 86,132 94,132" fill="#555"/>
    
    <line x1="90" y1="190" x2="90" y2="210" stroke="#555" stroke-width="1.5"/>
    <polygon points="90,215 86,207 94,207" fill="#555"/>

    <!-- ============================================================ -->
    <!-- CENTER ZONE: RL LOOP -->
    <!-- ============================================================ -->
    <rect x="180" y="50" width="420" height="300" rx="12" fill="#fffbeb" stroke="#fcd34d" stroke-width="2"/>
    <text x="390" y="72" font-family="Arial, sans-serif" font-size="11" font-weight="bold" fill="#b45309" text-anchor="middle">Reinforcement Learning Loop</text>

    <!-- Action Box (Î”W) -->
    <rect x="200" y="90" width="150" height="85" rx="6" fill="#ffffff" stroke="#f97316" stroke-width="1.5"/>
    <text x="275" y="108" font-family="Arial, sans-serif" font-size="10" font-weight="bold" fill="#c2410c" text-anchor="middle">Action (Î”W)</text>
    <line x1="205" y1="115" x2="345" y2="115" stroke="#fdba74" stroke-width="1"/>
    <text x="210" y="132" font-family="Arial, sans-serif" font-size="8" fill="#555">âˆ†W âˆˆ [-0.2, +0.2]</text>
    <text x="210" y="147" font-family="Arial, sans-serif" font-size="8" fill="#555">W_new = W Ã— (1 + âˆ†W)</text>
    <text x="210" y="162" font-family="Arial, sans-serif" font-size="8" fill="#555">W âˆˆ [420nm, 5Âµm]</text>

    <!-- Observation Box -->
    <rect x="440" y="90" width="145" height="85" rx="6" fill="#ffffff" stroke="#eab308" stroke-width="1.5"/>
    <text x="512" y="108" font-family="Arial, sans-serif" font-size="10" font-weight="bold" fill="#a16207" text-anchor="middle">Observation</text>
    <line x1="445" y1="115" x2="580" y2="115" stroke="#fcd34d" stroke-width="1"/>
    <text x="450" y="132" font-family="Arial, sans-serif" font-size="8" fill="#555">obs = [</text>
    <text x="455" y="147" font-family="Arial, sans-serif" font-size="8" fill="#555">W_norm[n_trans],</text>
    <text x="455" y="162" font-family="Arial, sans-serif" font-size="8" fill="#555">metrics[8], targets[8]]</text>

    <!-- PPO Agent -->
    <rect x="200" y="215" width="150" height="65" rx="12" fill="#fdba74" stroke="#f97316" stroke-width="2.5" filter="url(#shadow)"/>
    <text x="275" y="250" font-family="Arial, sans-serif" font-size="13" font-weight="bold" fill="#c2410c" text-anchor="middle">PPO Agent</text>
    <text x="275" y="268" font-family="Arial, sans-serif" font-size="10" fill="#c2410c" text-anchor="middle">(RL)</text>

    <!-- Gym Env -->
    <rect x="440" y="215" width="145" height="65" rx="12" fill="#fde047" stroke="#eab308" stroke-width="2" filter="url(#shadow)"/>
    <text x="512" y="245" font-family="Arial, sans-serif" font-size="12" font-weight="bold" fill="#a16207" text-anchor="middle">Gym Env</text>
    <text x="512" y="263" font-family="Arial, sans-serif" font-size="9" fill="#a16207" text-anchor="middle">(StandardCellEnv)</text>

    <!-- Arrow Action box -> Agent -->
    <line x1="275" y1="175" x2="275" y2="210" stroke="#f97316" stroke-width="1.5" stroke-dasharray="4,2"/>
    <polygon points="275,215 271,205 279,205" fill="#f97316"/>

    <!-- Arrow Observation box -> Env -->
    <line x1="512" y1="175" x2="512" y2="210" stroke="#eab308" stroke-width="1.5" stroke-dasharray="4,2"/>
    <polygon points="512,215 508,205 516,205" fill="#eab308"/>

    <!-- Arrow Agent -> Env (Action) -->
    <line x1="350" y1="235" x2="435" y2="235" stroke="#f97316" stroke-width="2"/>
    <polygon points="440,235 430,230 430,240" fill="#f97316"/>

    <!-- Arrow Env -> Agent (Obs/Reward) -->
    <line x1="440" y1="265" x2="355" y2="265" stroke="#22c55e" stroke-width="2"/>
    <polygon points="350,265 360,260 360,270" fill="#22c55e"/>

    <!-- Arrow Labels -->
    <rect x="375" y="218" width="40" height="14" rx="3" fill="#fff7ed" stroke="#fdba74" stroke-width="1"/>
    <text x="395" y="228" font-family="Arial, sans-serif" font-size="8" font-weight="bold" fill="#c2410c" text-anchor="middle">Action</text>

    <rect x="365" y="270" width="65" height="14" rx="3" fill="#ffffff" stroke="#eab308" stroke-width="1"/>
    <text x="397" y="280" font-family="Arial, sans-serif" font-size="8" font-weight="bold" fill="#a16207" text-anchor="middle">Obs / Reward</text>

    <!-- Arrow Workers -> Agent -->
    <line x1="155" y1="240" x2="195" y2="240" stroke="#555" stroke-width="1.5"/>
    <polygon points="200,240 190,235 190,245" fill="#555"/>

    <!-- ============================================================ -->
    <!-- RIGHT: REWARD CALCULATION -->
    <!-- ============================================================ -->

    <rect x="630" y="50" width="185" height="280" rx="12" fill="#fdf2f8" stroke="#f9a8d4" stroke-width="2"/>
    <text x="722" y="72" font-family="Arial, sans-serif" font-size="11" font-weight="bold" fill="#be185d" text-anchor="middle">Reward Calculation (V1.2)</text>

    <text x="640" y="95" font-family="Arial, sans-serif" font-size="9" font-weight="bold" fill="#555">1. Relative errors:</text>
    <line x1="705" y1="125" x2="780" y2="125" stroke="#666" stroke-width="1"/>
    <text x="745" y="120" font-family="Arial, sans-serif" font-size="8" fill="#666" text-anchor="middle">| val âˆ’ target |</text>
    <text x="655" y="128" font-family="Arial, sans-serif" font-size="9" fill="#666">err =</text>
    <text x="745" y="135" font-family="Arial, sans-serif" font-size="8" fill="#666" text-anchor="middle">target</text>

    <text x="640" y="155" font-family="Arial, sans-serif" font-size="9" font-weight="bold" fill="#555">2. Quadratic penalty:</text>
    <text x="655" y="172" font-family="Arial, sans-serif" font-size="9" fill="#666">R âˆ’= weight Ã— errÂ²</text>

    <text x="640" y="192" font-family="Arial, sans-serif" font-size="9" font-weight="bold" fill="#555">3. Strict weights:</text>
    <text x="655" y="207" font-family="Arial, sans-serif" font-size="8" fill="#666">delay &lt; 50ps â†’ w = 5</text>
    <text x="655" y="220" font-family="Arial, sans-serif" font-size="8" fill="#666">power &lt; 1ÂµW â†’ w = 5</text>

    <text x="640" y="240" font-family="Arial, sans-serif" font-size="9" font-weight="bold" fill="#555">4. P/N ratio penalty:</text>
    <text x="655" y="255" font-family="Arial, sans-serif" font-size="8" fill="#666">if W_PMOS &lt; W_NMOS:</text>
    <line x1="720" y1="275" x2="795" y2="275" stroke="#666" stroke-width="1"/>
    <text x="757" y="270" font-family="Arial, sans-serif" font-size="8" fill="#666" text-anchor="middle">Wn âˆ’ Wp</text>
    <text x="665" y="278" font-family="Arial, sans-serif" font-size="9" fill="#666">R âˆ’= 5 Ã—</text>
    <text x="757" y="288" font-family="Arial, sans-serif" font-size="8" fill="#666" text-anchor="middle">Wn</text>

    <text x="640" y="305" font-family="Arial, sans-serif" font-size="9" font-weight="bold" fill="#555">5. Success bonus:</text>
    <text x="655" y="322" font-family="Arial, sans-serif" font-size="9" fill="#666">âˆ€ err â‰¤ 10% â†’ R += 20</text>

    <!-- Arrow Env -> Reward (Results) -->
    <line x1="585" y1="247" x2="625" y2="247" stroke="#ec4899" stroke-width="1.5"/>
    <polygon points="630,247 620,242 620,252" fill="#ec4899"/>
    <rect x="590" y="252" width="40" height="14" rx="3" fill="#fdf2f8" stroke="#f9a8d4" stroke-width="1"/>
    <text x="610" y="262" font-family="Arial, sans-serif" font-size="8" fill="#be185d" text-anchor="middle">Results</text>
    
    <!-- ============================================================ -->
    <!-- BOTTOM LEFT: LEGEND -->
    <!-- ============================================================ -->
    <rect x="15" y="370" width="150" height="140" rx="8" fill="#ffffff" stroke="#e5e5e5" stroke-width="1"/>
    <text x="90" y="392" font-family="Arial, sans-serif" font-size="10" font-weight="bold" fill="#333" text-anchor="middle">Legend</text>
    
    <rect x="28" y="408" width="16" height="12" rx="2" fill="#86efac" stroke="#22c55e" stroke-width="1"/>
    <text x="50" y="418" font-family="Arial, sans-serif" font-size="8" fill="#555">User interface</text>
    
    <rect x="28" y="428" width="16" height="12" rx="2" fill="#fdba74" stroke="#f97316" stroke-width="1"/>
    <text x="50" y="438" font-family="Arial, sans-serif" font-size="8" fill="#555">RL Agent (PPO)</text>
    
    <rect x="28" y="448" width="16" height="12" rx="2" fill="#fde047" stroke="#eab308" stroke-width="1"/>
    <text x="50" y="458" font-family="Arial, sans-serif" font-size="8" fill="#555">Gym Environment</text>
    
    <rect x="28" y="468" width="16" height="12" rx="2" fill="#f9a8d4" stroke="#ec4899" stroke-width="1"/>
    <text x="50" y="478" font-family="Arial, sans-serif" font-size="8" fill="#555">Simulation / Objective</text>
    
    <rect x="28" y="488" width="16" height="12" rx="2" fill="#e5e5e5" stroke="#a3a3a3" stroke-width="1"/>
    <text x="50" y="498" font-family="Arial, sans-serif" font-size="8" fill="#555">Data persistence</text>

    <!-- ============================================================ -->
    <!-- BOTTOM: MODEL PERSISTENCE -->
    <!-- ============================================================ -->
    <rect x="180" y="370" width="190" height="180" rx="12" fill="#f5f5f5" stroke="#d4d4d4" stroke-width="2"/>
    <text x="275" y="392" font-family="Arial, sans-serif" font-size="11" font-weight="bold" fill="#525252" text-anchor="middle">Model Persistence</text>

    <!-- Weight Manager -->
    <rect x="205" y="420" width="140" height="40" rx="8" fill="#e5e5e5" stroke="#a3a3a3" stroke-width="2" filter="url(#shadow)"/>
    <text x="275" y="445" font-family="Arial, sans-serif" font-size="10" font-weight="bold" fill="#525252" text-anchor="middle">Weight Manager</text>


    <!-- JSON Cylinder -->
    <rect x="220" y="490" width="110" height="35" fill="#e5e5e5" stroke="none"/>
    <ellipse cx="275" cy="490" rx="55" ry="10" fill="#e5e5e5" stroke="#a3a3a3" stroke-width="1"/>
    <line x1="220" y1="490" x2="220" y2="525" stroke="#a3a3a3" stroke-width="1"/>
    <line x1="330" y1="490" x2="330" y2="525" stroke="#a3a3a3" stroke-width="1"/>
    <ellipse cx="275" cy="525" rx="55" ry="10" fill="#d4d4d4" stroke="#a3a3a3" stroke-width="1"/>
    <text x="275" y="512" font-family="Arial, sans-serif" font-size="9" font-weight="bold" fill="#525252" text-anchor="middle">JSON / Models</text>

    <!-- Arrow Weight Manager -> JSON -->
    <line x1="275" y1="460" x2="275" y2="478" stroke="#555" stroke-width="1.5"/>
    <polygon points="275,480 271,472 279,472" fill="#555"/>

    <!-- Arrow Agent -> Persistence -->
    <line x1="275" y1="280" x2="275" y2="365" stroke="#555" stroke-width="1.5"/>
    <polygon points="275,370 271,360 279,360" fill="#555"/>
    <text x="290" y="325" font-family="Arial, sans-serif" font-size="8" fill="#666">Save/Load</text>

    <!-- ============================================================ -->
    <!-- BOTTOM: SIMULATION CORE -->
    <!-- ============================================================ -->
    <rect x="390" y="370" width="245" height="180" rx="12" fill="#fdf4ff" stroke="#e879f9" stroke-width="2"/>
    <text x="512" y="392" font-family="Arial, sans-serif" font-size="11" font-weight="bold" fill="#a21caf" text-anchor="middle">Simulation Core</text>

    <!-- Objective Function -->
    <rect x="417" y="415" width="190" height="50" rx="10" fill="#f9a8d4" stroke="#ec4899" stroke-width="2" filter="url(#shadow)"/>
    <text x="512" y="438" font-family="Arial, sans-serif" font-size="10" font-weight="bold" fill="#be185d" text-anchor="middle">Objective Function</text>
    <text x="512" y="455" font-family="Arial, sans-serif" font-size="8" fill="#be185d" text-anchor="middle">Generates Netlist + Computes Cost</text>

    <!-- NGSpice -->
    <rect x="417" y="490" width="190" height="45" rx="10" fill="#e9d5ff" stroke="#a855f7" stroke-width="2" filter="url(#shadow)"/>
    <text x="512" y="510" font-family="Arial, sans-serif" font-size="10" font-weight="bold" fill="#7e22ce" text-anchor="middle">NGSpice</text>
    <text x="512" y="525" font-family="Arial, sans-serif" font-size="8" fill="#7e22ce" text-anchor="middle">(SPICE Simulator)</text>

    <!-- Simulation Arrows -->
    <line x1="470" y1="465" x2="470" y2="485" stroke="#555" stroke-width="1.5"/>
    <polygon points="470,490 466,482 474,482" fill="#555"/>
    <text x="450" y="480" font-family="Arial, sans-serif" font-size="7" fill="#666">Netlist</text>

    <line x1="555" y1="490" x2="555" y2="470" stroke="#555" stroke-width="1.5"/>
    <polygon points="555,465 551,473 559,473" fill="#555"/>
    <text x="570" y="480" font-family="Arial, sans-serif" font-size="7" fill="#666">Metrics</text>

    <!-- Arrow Env -> Simulation (Widths) -->
    <line x1="490" y1="280" x2="490" y2="365" stroke="#555" stroke-width="1.5"/>
    <polygon points="490,370 486,360 494,360" fill="#555"/>
    <text x="460" y="325" font-family="Arial, sans-serif" font-size="8" fill="#666">Widths</text>

    <!-- ============================================================ -->
    <!-- BOTTOM RIGHT: TARGET METRICS -->
    <!-- ============================================================ -->
    <rect x="655" y="370" width="160" height="180" rx="12" fill="#ecfdf5" stroke="#6ee7b7" stroke-width="2"/>
    <text x="735" y="392" font-family="Arial, sans-serif" font-size="11" font-weight="bold" fill="#047857" text-anchor="middle">Target Metrics</text>

    <text x="670" y="420" font-family="Arial, sans-serif" font-size="9" fill="#555">â€¢ delay_rise / fall</text>
    <text x="670" y="438" font-family="Arial, sans-serif" font-size="9" fill="#555">â€¢ slew_in / slew_out</text>
    <text x="670" y="456" font-family="Arial, sans-serif" font-size="9" fill="#555">â€¢ power_dyn / leak</text>
    <text x="670" y="474" font-family="Arial, sans-serif" font-size="9" fill="#555">â€¢ area_um2</text>

    <line x1="665" y1="488" x2="805" y2="488" stroke="#6ee7b7" stroke-width="1"/>
    <text x="670" y="508" font-family="Arial, sans-serif" font-size="8" fill="#666">ðŸŽ² Training: random targets</text>
    <text x="670" y="525" font-family="Arial, sans-serif" font-size="8" fill="#666">ðŸŽ¯ Inference: user targets</text>

    <!-- GREEN TARGETS ARROW - RIGHT ANGLES -->
    <polyline points="735,370 735,360 530,360 530,285" stroke="#059669" stroke-width="2" fill="none"/>
    <polygon points="530,280 525,290 535,290" fill="#059669"/>
    <text x="620" y="355" font-family="Arial, sans-serif" font-size="8" font-weight="bold" fill="#059669">Targets</text>

</svg>
